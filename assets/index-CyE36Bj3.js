(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))t(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const d of s.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&t(d)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();let w,o,r=0,u;const b="https://uat-api-loyalty.therealreward.com",I="b2njfBb8pnBcm3onyI4eaQzW4n12s2nf",B="4wK3xE4kLo3LeNbO",T="b8d2468b-23c3-4e0b-8b7e-0cf8ad11718f",A="f0bfc5b2f6ff4b0fa1ec218a9aa405dd";let S="",C=[],k="PUBLISHED",R=Phaser.Math.FloatBetween(2,43);const W={type:Phaser.AUTO,width:Math.min(480,window.innerWidth),height:window.innerHeight,parent:"game-container",resolution:2,scene:{preload:_,create:D,update:L}};let m=[{val:-1,label:"Jelly 1 Stick",code:"C001",weight:0,img:"reward_r001"},{val:-2,label:"Tole Bag",code:"C002",weight:0,img:"reward_r002"},{val:-3,label:"Sakkin Kid",code:"C003",weight:0,img:"reward_r003"},{val:-4,label:"Sakkin 100ml",code:"C004",weight:0,img:"reward_r004"},{val:3,label:"Sakkin Veggie",code:"C005",weight:0,img:"reward_r005"},{val:1,label:"Aojiru 1 Box",code:"C006",weight:0,img:"reward_r006"},{val:2,label:"Aojiru Gift $10",code:"C007",weight:0,img:"reward_r007"},{val:0,label:"Voucher $10",code:"C008",weight:0,img:"reward_r008"}];function v(e){console.log("text ",e);const i=CryptoJS.enc.Utf8.parse(I),n=CryptoJS.enc.Utf8.parse(B),t=CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(e),i,{keySize:128/8,iv:n,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7});return console.log("encrypted ",t.toString()),t.toString()}async function x(){var e,i;try{let n={key:v.call(this,T),secret:v.call(this,A)};const t=await axios.post(`${b}/partner/v1/login`,n,{headers:{"Content-Type":"application/json"}});t.data.response.status==200&&(S=(i=(e=t.data)==null?void 0:e.results)==null?void 0:i.token),console.log("API Response:",t.data)}catch(n){console.error("Error fetching data:",n)}}async function O(){try{await x.call(),C=(await axios.post(`${b}/partner/v1/lucky-reward`,"",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${S}`}})).data.results,await z.call()}catch(e){console.error("Error fetching data:",e)}}async function P(e){try{return await x.call(),(await axios.post(`${b}/partner/v1/lucky-reward/check`,{key:e},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${S}`}})).data.results.code}catch(i){console.error("Error fetching data:",i)}}function _(){this.load.audio("introSound","assets/audios/intro.mp3"),this.load.audio("collectSound","assets/audios/collect.mp3"),this.load.audio("spinSound","assets/audios/spinSound.mp3"),this.load.image("background","assets/images/background.png"),this.load.image("wheel","assets/images/wheel.png"),this.load.image("bgWheelTop","assets/images/bgWheelTop.png"),this.load.image("bgWheel","assets/images/bgWheel.png"),this.load.image("pin","assets/images/pin.png"),this.load.image("spinButton","assets/images/spinButton.png"),this.load.image("spinButtonDown","assets/images/spinButtonDown.png"),this.load.image("bgReward","assets/images/blur.png"),this.load.image("box","assets/images/box.png"),this.load.image("btnClaim","assets/images/btnClaim.png"),this.load.image("icSound","assets/images/sound.png"),this.load.image("icSoundOff","assets/images/soundOff.png"),this.load.image("bgCoin","assets/images/bgCoin.png"),this.load.image("btnAdd","assets/images/add.png"),this.load.image("btnMinus","assets/images/minus.png"),this.load.image("reward_r001","assets/images/r001.png"),this.load.image("reward_r002","assets/images/r002.png"),this.load.image("reward_r003","assets/images/r003.png"),this.load.image("reward_r004","assets/images/r004.png"),this.load.image("reward_r005","assets/images/r005.png"),this.load.image("reward_r006","assets/images/r006.png"),this.load.image("reward_r007","assets/images/r007.png"),this.load.image("reward_r008","assets/images/r008.png"),this.load.spritesheet("firework","assets/images/firework.png",{frameWidth:480,frameHeight:480,endFrame:10}),this.load.script("webfont","https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js")}async function D(){let e=!0;await O.call(),await y.call();const i=this.sound.add("introSound"),n=this.sound.add("collectSound"),t=this.sound.add("spinSound");this.add.image(this.cameras.main.centerX,this.cameras.main.centerY,"background").setOrigin(.5,.5).setDisplaySize(this.cameras.main.width,this.cameras.main.height);const a=this.add.sprite(this.cameras.main.width/2,this.cameras.main.height/2,"icSoundOff");a.setPosition(this.cameras.main.width-12,12),a.setOrigin(1,-.1),a.setScale(.5);const s=this.add.sprite(this.cameras.main.width/2,this.cameras.main.height/2,"icSound");s.setPosition(this.cameras.main.width-12,12),s.setOrigin(1,-.1),s.setScale(.5);const d=this.add.sprite(s.x-s.displayWidth-10,s.y,"btnAdd");d.setScale(.7),d.setOrigin(1,0),d.setInteractive(),d.on("pointerdown",()=>{r||(r=0),r=parseInt(r)+1,localStorage.setItem("spinNumber",r),y.call(),u.setText(`${r}`)}),u=this.add.text(s.x-s.displayWidth-70,42,`${r}`,{font:"24px Arial",fill:"#000000"}),u.setOrigin(.5,1);const l=this.add.sprite(s.x-s.displayWidth-100,s.y,"btnMinus");l.setScale(.7),l.setOrigin(1,0),l.setInteractive(),l.on("pointerdown",()=>{r>0&&(r=r-1),localStorage.setItem("spinNumber",r),y.call(),u.setText(`${r}`)});const p=this.add.sprite(this.cameras.main.width/2,160,"bgWheelTop");p.setScale(.65),p.setOrigin(.5,.5);const g=this.add.sprite(this.cameras.main.width/2,320,"wheel");g.setScale(.26),g.setOrigin(.5,.5);const c=this.add.sprite(this.cameras.main.width/2,320,"bgWheel");c.setScale(.67),c.setOrigin(.5,.5),o=this.add.sprite(this.cameras.main.width/2,this.cameras.main.height-100,"spinButton"),o.setScale(.4),o.setOrigin(.5,1),o.setInteractive(),o.on("pointerdown",()=>{o.setTexture("spinButtonDown")}),o.on("pointerup",M.bind(this,g,t,n,f)),o.on("pointerout",()=>{o.setTexture("spinButton")}),s.setInteractive(),s.on("pointerdown",()=>{e=!e,i.setMute(e),n.setMute(e),t.setMute(e),e?s.setTexture("icSound"):(s.setTexture("icSoundOff"),i.play())})}function L(){}new Phaser.Game(W);function M(e,i,n,t){if(r<1){t("Please Top up to spin!");return}o.setTexture("spinButton"),o.disableInteractive();const a=N(m);console.log("rewardList ",m);const s=m.indexOf(a),d=360/m.length,l=R,p=s*d+l,c=360*Phaser.Math.Between(2,4)+p;this.tweens.add({targets:e,angle:c,ease:Phaser.Math.Easing.Cubic.Out,duration:Phaser.Math.Between(4e3,5e3),onStart:()=>i.play(),onComplete:()=>{i.stop(),n.play(),console.log("Winning Reward:",a.label),t(a.label),$.call(this,a)}})}function N(e){const i=e.reduce((t,a)=>t+a.weight,0);let n=Math.random()*i;for(const t of e){if(n<t.weight)return t;n-=t.weight}}function $(e){let i=C.find(h=>h.ref==e.code).item;i=i.filter(h=>h.status==k),console.log("reward ",e.img);let n=i[0].data;this.anims.create({key:"fireworkAnim",frames:this.anims.generateFrameNumbers("firework",{frames:[0,1,2,3,4,5,6,7,8,9]}),frameRate:16,repeat:-1});const t=this.add.sprite(200,100,"firework");t.play("fireworkAnim",!0),t.setDepth(1e3),t.setDisplaySize(250,250);const a=this.add.sprite(100,300,"firework");a.play("fireworkAnim",!0),a.setDepth(1e3),a.setDisplaySize(200,200);const s=this.add.sprite(this.cameras.main.width-75,250,"firework");s.play("fireworkAnim",!0),s.setDepth(1e3),s.setDisplaySize(150,150);const d=this.add.image(this.cameras.main.centerX,this.cameras.main.centerY,"bgReward");d.setOrigin(.5,.5),d.setDisplaySize(this.cameras.main.width,this.cameras.main.height);const l=this.add.sprite(this.cameras.main.width/2,this.cameras.main.height/2,`${e.img}`);l.setOrigin(.5,.5),l.setScale(.16),E.call(this,n,l);const p={font:"26px Charm",fill:"#ffffff",align:"center",resolution:2},g=this.add.text(this.cameras.main.centerX,l.y-l.displayHeight+130,`Congratulations!
You won ${e.label}`,p);g.setOrigin(.5,.5);const c=this.add.image(this.cameras.main.centerX,this.cameras.main.height-100,"btnClaim");c.setOrigin(.5,.5),c.setScale(.5),c.setInteractive(),c.on("pointerdown",async()=>{console.log("linkQRCode ",n);let h=await P.call(this,n);if(!h){f("Something went wrong");return}if(h=="00"){f("Reward Not Claimed");return}else if(h=="02"){f("Reward link is invalid");return}await O.call(),f("Claim Success!"),d.destroy(),g.destroy(),l.destroy(),c.destroy(),t.destroy(),a.destroy(),s.destroy(),w&&(w.destroy(),w=null,this.textures.exists("qrCanvas")&&this.textures.remove("qrCanvas")),o.setInteractive(),j.call()})}function E(e,i){const n=new QRious({value:e,size:120}),t=new Image;t.src=n.toDataURL(),t.onload=()=>{const a=this.textures.createCanvas("qrCanvas",t.width,t.height);a.context.drawImage(t,0,0),a.refresh(),w=this.add.image(i.x,i.y+i.displayHeight/2-12,"qrCanvas"),w.setOrigin(.5,1)},t.onerror=()=>{console.error("Failed to load QR code image.")}}function y(){const e=localStorage.getItem("spinNumber");e&&(r=e),o&&(r==0?o.disableInteractive():o.setInteractive())}async function z(){m=m.map(e=>{let i=C.find(t=>t.ref===e.code);const n=i?i.item.filter(t=>t.status===k).length:0;return{...e,weight:n}}),console.log("rewardList ",m)}function j(){r&&r>0?r=r-1:r=0,o&&(r==0?o.disableInteractive():o.setInteractive()),localStorage.setItem("spinNumber",r),u.setText(`${r}`)}function f(e){const i=document.getElementById("toast");i.textContent=e,i.classList.add("show"),setTimeout(()=>{i.classList.remove("show")},3e3)}
