(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const t of i)if(t.type==="childList")for(const l of t.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function r(i){const t={};return i.integrity&&(t.integrity=i.integrity),i.referrerPolicy&&(t.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?t.credentials="include":i.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function s(i){if(i.ep)return;i.ep=!0;const t=r(i);fetch(i.href,t)}})();let w,o,n=0,u,y="https://uat-api-loyalty.therealreward.com",S="",v=[],x="PUBLISHED",O=Phaser.Math.FloatBetween(2,43);const I={type:Phaser.AUTO,width:Math.min(480,window.innerWidth),height:window.innerHeight,parent:"game-container",resolution:2,scene:{preload:T,create:B,update:W}};let m=[{val:-1,label:"Jelly 1 Stick",code:"C001",weight:0,img:"reward_r001"},{val:-2,label:"Tole Bag",code:"C002",weight:0,img:"reward_r002"},{val:-3,label:"Sakkin Kid",code:"C003",weight:0,img:"reward_r003"},{val:-4,label:"Sakkin 100ml",code:"C004",weight:0,img:"reward_r004"},{val:3,label:"Sakkin Veggie",code:"C005",weight:0,img:"reward_r005"},{val:1,label:"Aojiru 1 Box",code:"C006",weight:0,img:"reward_r006"},{val:2,label:"Aojiru Gift $10",code:"C007",weight:0,img:"reward_r007"},{val:0,label:"Voucher $10",code:"C008",weight:0,img:"reward_r008"}];async function C(){var e,a;try{const r={key:"UboUHbQFY9BHtzAjlgsD3SQaocx9lMXvfSoxxetRAvpRQ1P4CwWcKdOwTwWkOD7j",secret:"8f1f4ei/si3hCVjGUOvIpF5g42+EpnE6gNUrEik4yHwvplllhJaEmR+MepqFz1cf"},s=await axios.post(`${y}/partner/v1/login`,r,{headers:{"Content-Type":"application/json"}});s.data.response.status==200&&(S=(a=(e=s.data)==null?void 0:e.results)==null?void 0:a.token),console.log("API Response:",s.data)}catch(r){console.error("Error fetching data:",r)}}async function k(){try{await C.call(),v=(await axios.post(`${y}/partner/v1/lucky-reward`,"",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${S}`}})).data.results,await _.call()}catch(e){console.error("Error fetching data:",e)}}async function R(e){try{return await C.call(),(await axios.post(`${y}/partner/v1/lucky-reward/check`,{key:e},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${S}`}})).data.results.code}catch(a){console.error("Error fetching data:",a)}}function T(){this.load.audio("introSound","assets/audios/intro.mp3"),this.load.audio("collectSound","assets/audios/collect.mp3"),this.load.audio("spinSound","assets/audios/spinSound.mp3"),this.load.image("background","assets/images/background.png"),this.load.image("wheel","assets/images/wheel.png"),this.load.image("bgWheelTop","assets/images/bgWheelTop.png"),this.load.image("bgWheel","assets/images/bgWheel.png"),this.load.image("pin","assets/images/pin.png"),this.load.image("spinButton","assets/images/spinButton.png"),this.load.image("spinButtonDown","assets/images/spinButtonDown.png"),this.load.image("bgReward","assets/images/blur.png"),this.load.image("box","assets/images/box.png"),this.load.image("btnClaim","assets/images/btnClaim.png"),this.load.image("icSound","assets/images/sound.png"),this.load.image("icSoundOff","assets/images/soundOff.png"),this.load.image("bgCoin","assets/images/bgCoin.png"),this.load.image("btnAdd","assets/images/add.png"),this.load.image("btnMinus","assets/images/minus.png"),this.load.image("reward_r001","assets/images/r001.png"),this.load.image("reward_r002","assets/images/r002.png"),this.load.image("reward_r003","assets/images/r003.png"),this.load.image("reward_r004","assets/images/r004.png"),this.load.image("reward_r005","assets/images/r005.png"),this.load.image("reward_r006","assets/images/r006.png"),this.load.image("reward_r007","assets/images/r007.png"),this.load.image("reward_r008","assets/images/r008.png"),this.load.spritesheet("firework","assets/images/firework.png",{frameWidth:480,frameHeight:480,endFrame:10}),this.load.script("webfont","https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js")}async function B(){let e=!0;await k.call(),await b.call();const a=this.sound.add("introSound"),r=this.sound.add("collectSound"),s=this.sound.add("spinSound");this.add.image(this.cameras.main.centerX,this.cameras.main.centerY,"background").setOrigin(.5,.5).setDisplaySize(this.cameras.main.width,this.cameras.main.height);const i=this.add.sprite(this.cameras.main.width/2,this.cameras.main.height/2,"icSoundOff");i.setPosition(this.cameras.main.width-12,12),i.setOrigin(1,-.1),i.setScale(.5);const t=this.add.sprite(this.cameras.main.width/2,this.cameras.main.height/2,"icSound");t.setPosition(this.cameras.main.width-12,12),t.setOrigin(1,-.1),t.setScale(.5);const l=this.add.sprite(t.x-t.displayWidth-10,t.y,"btnAdd");l.setScale(.7),l.setOrigin(1,0),l.setInteractive(),l.on("pointerdown",()=>{n||(n=0),n=parseInt(n)+1,localStorage.setItem("spinNumber",n),b.call(),u.setText(`${n}`)}),u=this.add.text(t.x-t.displayWidth-70,42,`${n}`,{font:"24px Arial",fill:"#000000"}),u.setOrigin(.5,1);const d=this.add.sprite(t.x-t.displayWidth-100,t.y,"btnMinus");d.setScale(.7),d.setOrigin(1,0),d.setInteractive(),d.on("pointerdown",()=>{n>0&&(n=n-1),localStorage.setItem("spinNumber",n),b.call(),u.setText(`${n}`)});const p=this.add.sprite(this.cameras.main.width/2,160,"bgWheelTop");p.setScale(.65),p.setOrigin(.5,.5);const h=this.add.sprite(this.cameras.main.width/2,320,"wheel");h.setScale(.26),h.setOrigin(.5,.5);const c=this.add.sprite(this.cameras.main.width/2,320,"bgWheel");c.setScale(.67),c.setOrigin(.5,.5),o=this.add.sprite(this.cameras.main.width/2,this.cameras.main.height-100,"spinButton"),o.setScale(.4),o.setOrigin(.5,1),o.setInteractive(),o.on("pointerdown",()=>{o.setTexture("spinButtonDown")}),o.on("pointerup",A.bind(this,h,s,r,f)),o.on("pointerout",()=>{o.setTexture("spinButton")}),t.setInteractive(),t.on("pointerdown",()=>{e=!e,a.setMute(e),r.setMute(e),s.setMute(e),e?t.setTexture("icSound"):(t.setTexture("icSoundOff"),a.play())})}function W(){}new Phaser.Game(I);function A(e,a,r,s){if(n<1){s("Please Top up to spin!");return}o.setTexture("spinButton"),o.disableInteractive();const i=P(m);console.log("rewardList ",m);const t=m.indexOf(i),l=360/m.length,d=O,p=t*l+d,c=360*Phaser.Math.Between(2,4)+p;this.tweens.add({targets:e,angle:c,ease:Phaser.Math.Easing.Cubic.Out,duration:Phaser.Math.Between(4e3,5e3),onStart:()=>a.play(),onComplete:()=>{a.stop(),r.play(),console.log("Winning Reward:",i.label),s(i.label),D.call(this,i)}})}function P(e){const a=e.reduce((s,i)=>s+i.weight,0);let r=Math.random()*a;for(const s of e){if(r<s.weight)return s;r-=s.weight}}function D(e){let a=v.find(g=>g.ref==e.code).item;a=a.filter(g=>g.status==x),console.log("reward ",e.img);let r=a[0].data;this.anims.create({key:"fireworkAnim",frames:this.anims.generateFrameNumbers("firework",{frames:[0,1,2,3,4,5,6,7,8,9]}),frameRate:16,repeat:-1});const s=this.add.sprite(200,100,"firework");s.play("fireworkAnim",!0),s.setDepth(1e3),s.setDisplaySize(250,250);const i=this.add.sprite(100,300,"firework");i.play("fireworkAnim",!0),i.setDepth(1e3),i.setDisplaySize(200,200);const t=this.add.sprite(this.cameras.main.width-75,250,"firework");t.play("fireworkAnim",!0),t.setDepth(1e3),t.setDisplaySize(150,150);const l=this.add.image(this.cameras.main.centerX,this.cameras.main.centerY,"bgReward");l.setOrigin(.5,.5),l.setDisplaySize(this.cameras.main.width,this.cameras.main.height);const d=this.add.sprite(this.cameras.main.width/2,this.cameras.main.height/2,`${e.img}`);d.setOrigin(.5,.5),d.setScale(.16),M.call(this,r,d);const p={font:"26px Charm",fill:"#ffffff",align:"center",resolution:2},h=this.add.text(this.cameras.main.centerX,d.y-d.displayHeight+130,`Congratulations!
You won ${e.label}`,p);h.setOrigin(.5,.5);const c=this.add.image(this.cameras.main.centerX,this.cameras.main.height-100,"btnClaim");c.setOrigin(.5,.5),c.setScale(.5),c.setInteractive(),c.on("pointerdown",async()=>{console.log("linkQRCode ",r);let g=await R.call(this,r);if(!g){f("Something went wrong");return}if(g=="00"){f("Reward Not Claimed");return}else if(g=="02"){f("Reward link is invalid");return}await k.call(),f("Claim Success!"),l.destroy(),h.destroy(),d.destroy(),c.destroy(),s.destroy(),i.destroy(),t.destroy(),w&&(w.destroy(),w=null,this.textures.exists("qrCanvas")&&this.textures.remove("qrCanvas")),o.setInteractive(),N.call()})}function M(e,a){const r=new QRious({value:e,size:120}),s=new Image;s.src=r.toDataURL(),s.onload=()=>{const i=this.textures.createCanvas("qrCanvas",s.width,s.height);i.context.drawImage(s,0,0),i.refresh(),w=this.add.image(a.x,a.y+a.displayHeight/2-12,"qrCanvas"),w.setOrigin(.5,1)},s.onerror=()=>{console.error("Failed to load QR code image.")}}function b(){const e=localStorage.getItem("spinNumber");e&&(n=e),o&&(n==0?o.disableInteractive():o.setInteractive())}async function _(){m=m.map(e=>{let a=v.find(s=>s.ref===e.code);const r=a?a.item.filter(s=>s.status===x).length:0;return{...e,weight:r}}),console.log("rewardList ",m)}function N(){n&&n>0?n=n-1:n=0,o&&(n==0?o.disableInteractive():o.setInteractive()),localStorage.setItem("spinNumber",n),u.setText(`${n}`)}function f(e){const a=document.getElementById("toast");a.textContent=e,a.classList.add("show"),setTimeout(()=>{a.classList.remove("show")},3e3)}
